(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{339:function(e,t,s){"use strict";var r=function(e){var t;switch(e){case 0:t="普通用户";break;case 1:t="普通管理员";break;case 2:t="2级管理员";break;case 10:t="超级管理员";break;default:t="未设定"}return t},a={props:["user"],name:"",inject:["reload"],data:function(){return{userRole:JSON.parse(sessionStorage.getItem("user")).role,options:[0,1,2,10],formLoading:!1,form:{_id:null,userName:null,password:null,email:null,state:null,role:null},rules:{userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:18,message:"长度在 3 到 18 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:3,max:18,message:"长度在 3 到 18 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请检查邮箱格式",trigger:"blur"}],role:[{required:!0,message:"请选择权限",trigger:"blur"}]},dialogVisible:!1,users:[{userName:"test1",password:"123445",email:"xxxx@xxx.com",state:!0,role:"管理员"}],page:1,everyNum:10,search:"",isSearch:!1,isUpdate:!1}},components:{},methods:{roleName:function(e){return r(e)},onChangeState:function(e,t){var s=this;this.axios.post("/user/updateUser",{_id:e,state:t}).then((function(e){200==e.status&&(s.$message({message:"状态修改成功",type:"success"}),s.reload())})).catch((function(e){e.response&&404==e.response.status&&s.$message.error({message:"修改失败，该用户已被删除或不存在"}),console.log(e)}))},onUpdateUser:function(e){var t=this,s={_id:this.form._id,userName:this.form.userName,password:this.form.password,email:this.form.email,role:this.form.role,state:this.form.state};console.log("onUpdateUser",s),this.$refs[e].validate((function(e){e?(t.formLoading=!0,t.axios.post("/user/updateUser",s).then((function(e){200==e.status&&(t.$message({message:"创建成功",type:"success"}),t.reload())})).catch((function(e){e.response&&404==e.response.status&&t.$message.error({message:"删除失败，该用户已经被删除或不存在"}),t.formLoading=!1,t.dialogVisible=!1}))):t.$message.error("请检查输入信息")}))},onUpdate:function(e,t,s,r,a,o){this.form._id=e,this.form.userName=t,this.form.password=s,this.form.email=r,this.form.role=a,this.form.state=o,this.isUpdate=!0,this.dialogVisible=!0},onRemoveUser:function(e){var t=this,s=e;this.axios.post("/user/removeUser",{_id:s}).then((function(e){200==e.status&&(t.$message({message:"删除成功",type:"success"}),t.reload())})).catch((function(e){e.response&&404==e.response.status&&t.$message.error({message:"删除失败，该用户已经被删除或不存在"}),console.log(e)}))},onAddUser:function(e){var t=this,s={userName:this.form.userName,password:this.form.password,email:this.form.email,role:this.form.role};console.log(s);var r="/user/add"+this.user;this.$refs[e].validate((function(e){e?(t.formLoading=!0,t.axios.post(r,s).then((function(e){console.log("then res",e),200==e.status&&(console.log(e.data),t.$message({message:"创建成功",type:"success"}),t.reload()),t.formLoading=!1,t.dialogVisible=!1})).catch((function(e){console.log("catch err",e),e.response&&403==e.response.status&&t.$message.error("用户名重复！请重试！"),t.formLoading=!1,t.dialogVisible=!1}))):t.$message.error("请检查输入信息")}))},searchUser:function(){var e=this;console.log(this.user);var t,s,r=this.page,a=this.everyNum,o=this.userRole;this.isSearch&&(t=this.search,s=this.search);var i={page:r,everyNum:a,userName:t,email:s,role:o},n="/user/find"+this.user;console.log("searchUser",i),this.axios.post(n,i).then((function(t){console.log(t),200==t.status&&(e.users=t.data.data)})).catch((function(e){console.log(e)}))},addUser:function(){}},watch:{page:{handler:function(e){console.log(e),this.searchUser()},immediate:!0},isSearch:function(e){console.log(e),this.searchUser()}},created:function(){}};t.a=a},350:function(e,t,s){"use strict";s.r(t),s.d(t,"render",(function(){return r})),s.d(t,"staticRenderFns",(function(){return a}));var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-tabs",{on:{"tab-click":function(t){return e.saveClick()}},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:"普通用户",name:"user"}},[s("userForm",{attrs:{user:"User"}})],1),e._v(" "),s("el-tab-pane",{attrs:{label:"管理员",name:"manager"}},[s("managerForm",{attrs:{user:"Manager"}})],1)],1)],1)},a=[];r._withStripped=!0},351:function(e,t,s){"use strict";var r=s(366),a={name:"",data:function(){return{activeName:"user"}},components:{userForm:r.a,managerForm:r.a},methods:{saveClick:function(){sessionStorage.setItem("tabClick",this.activeName)}},created:function(){sessionStorage.getItem("tabClick")&&(this.activeName=sessionStorage.getItem("tabClick")),console.log("activeName",this.activeName)}};t.a=a},362:function(e,t,s){"use strict";s.r(t),s.d(t,"render",(function(){return r})),s.d(t,"staticRenderFns",(function(){return a}));var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticStyle:{width:"20%"}},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"输入搜索内容，回车或者失去焦点搜索，点击右侧x取消搜索结果",placement:"top-start"}},[s("el-input",{attrs:{placeholder:"请输入内容"},on:{change:function(t){e.search.length?e.isSearch=!0:e.isSearch=!1}},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}},[s("i",{directives:[{name:"show",rawName:"v-show",value:!e.isSearch,expression:"!isSearch"}],staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"}),e._v(" "),s("i",{directives:[{name:"show",rawName:"v-show",value:e.isSearch,expression:"isSearch"}],staticClass:"el-icon-close el-input__icon",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function(t){e.isSearch=!1,e.search=""}},slot:"suffix"})])],1)],1),e._v(" "),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.users}},[s("el-table-column",{attrs:{prop:"userName",label:"用户名",width:"280"}}),e._v(" "),s("el-table-column",{attrs:{prop:"password",label:"密码",width:"280"}}),e._v(" "),s("el-table-column",{attrs:{prop:"email",label:"邮箱",width:"280"}}),e._v(" "),s("el-table-column",{attrs:{label:"角色",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(e.roleName(t.row.role)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"状态",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-switch",{on:{change:function(s){return e.onChangeState(t.row._id,t.row.state)}},model:{value:t.row.state,callback:function(s){e.$set(t.row,"state",s)},expression:"scope.row.state"}})]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{on:{click:function(s){return e.onUpdate(t.row._id,t.row.userName,t.row.password,t.row.email,t.row.role,t.row.state)}}},[e._v("编辑")]),e._v(" "),s("el-popconfirm",{attrs:{title:"确定删除"+t.row.userName+"吗？"},on:{onConfirm:function(s){return e.onRemoveUser(t.row._id)}}},[s("el-button",{attrs:{slot:"reference",type:"danger"},slot:"reference"},[e._v("删除")])],1)]}}])})],1),e._v(" "),s("div",{staticStyle:{"margin-top":"20px"}},[s("el-button",{on:{click:function(t){e.dialogVisible=!0,e.isUpdate=!1}}},[e._v("创建"+e._s("Manager"==e.user?"管理员":"新用户"))]),e._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:e.user.length>=e.everyNum,expression:"user.length>=everyNum"}],staticStyle:{float:"right"},on:{click:function(t){e.page=e.page+1}}},[e._v("下一页")]),e._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:1!=e.page,expression:"page!=1"}],staticStyle:{float:"right"},on:{click:function(t){e.page=e.page-1}}},[e._v("上一页")])],1),e._v(" "),s("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}],attrs:{title:"提示",visible:e.dialogVisible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("div",{staticStyle:{display:"flex","justify-content":"center"}},[s("el-form",{ref:"addUserForm",staticStyle:{width:"70%"},attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[s("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[s("el-input",{attrs:{disabled:e.isUpdate},model:{value:e.form.userName,callback:function(t){e.$set(e.form,"userName",t)},expression:"form.userName"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"密码",prop:"password"}},[s("el-input",{model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[s("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),"Manager"==e.user|e.isUpdate?s("el-form-item",{attrs:{label:"管理权限",prop:"role"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.role,callback:function(t){e.$set(e.form,"role",t)},expression:"form.role"}},e._l(e.options.filter((function(t){return t<e.userRole&&(0!=t||e.isUpdate)})),(function(t){return s("el-option",{key:t,attrs:{label:e.roleName(t),value:t}})})),1)],1):e._e()],1)],1),e._v(" "),s("div",{staticStyle:{display:"flex","justify-content":"flex-end"}},[s("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),e.isUpdate?e._e():s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onAddUser("addUserForm")}}},[e._v("提交")]),e._v(" "),e.isUpdate?s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onUpdateUser("addUserForm")}}},[e._v("提交修改")]):e._e()],1)])],1)},a=[];r._withStripped=!0},366:function(e,t,s){"use strict";var r=s(362),a=s(339),o=s(54),i=Object(o.a)(a.a,r.render,r.staticRenderFns,!1,null,"6e7f6e03",null),n=s(86);n.install(s(0)),n.compatible&&(e.hot.accept(),n.isRecorded("6e7f6e03")?n.reload("6e7f6e03",i.options):n.createRecord("6e7f6e03",i.options),e.hot.accept(362,function(e){r=s(362),n.rerender("6e7f6e03",{render:r.render,staticRenderFns:r.staticRenderFns})}.bind(this))),i.options.__file="src/components/userManage/tableForm.vue",t.a=i.exports},575:function(e,t,s){"use strict";s.r(t);var r=s(350),a=s(351),o=s(54),i=Object(o.a)(a.a,r.render,r.staticRenderFns,!1,null,"35b989cd",null),n=s(86);n.install(s(0)),n.compatible&&(e.hot.accept(),n.isRecorded("35b989cd")?n.reload("35b989cd",i.options):n.createRecord("35b989cd",i.options),e.hot.accept(350,function(e){r=s(350),n.rerender("35b989cd",{render:r.render,staticRenderFns:r.staticRenderFns})}.bind(this))),i.options.__file="src/Views/userManage/index.vue",t.default=i.exports}}]);